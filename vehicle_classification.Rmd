---
title: "Vehicle Classification in Norway"
output: html_notebook
---


```{r setup, include = FALSE, echo = FALSE}
# Packages
library(tidyverse)
library(flextable)
library(hexbin)

# knitr options
knitr::opts_chunk$set(echo = FALSE,
                      warning = FALSE,
                      message = FALSE,
                      error = FALSE)

# Data is prepared in vehicle_register_data_prep.R
```

Hva er sammenhengen mellom lengde og tillatt totalvekt?
```{r getdata}
all_small_vehicles %>% 
  dplyr::slice(1:200000) %>% 
  ggplot(aes(tekn_lengde, tekn_totvekt)) +
  ggplot2::geom_point() +
  geom_vline(aes(xintercept = 5.6), color = "#ed1c2e", alpha = 0.6) +
  geom_hline(aes(yintercept = 3.5), color = "#ed1c2e", alpha = 0.6) +
  facet_wrap(vars(tekn_tknavn)) +
  theme_bw() +
  labs(x = "\nKjøretøylengde (m)", y = "Tillatt totalvekt (tonn)\n") +
  ggtitle("Sammenheng mellom lengde og tillatt totalvekt")
```


```{r vegtek}
# vegtek_columns_to_be_removed <- c("tekn_drivst",
#                                   "tekn_euronorm_ny",
#                                   "tekn_hybrid",
#                                   "tekn_hybrid_kategori",
#                                   "tekn_merkenavn")
# 
# vehicle_info %>% 
#         dplyr::select(!tidyselect::all_of(vegtek_columns_to_be_removed)) %>% 
#         writexl::write_xlsx(path = "kjoretoy_O3.xlsx")
```

```{r 2d}
all_small_vehicles %>% 
  #dplyr::slice(1:200000) %>% 
  ggplot(aes(tekn_lengde, tekn_totvekt)) +
  ggplot2::geom_hex() +
  geom_vline(aes(xintercept = 5.6), color = "#ed1c2e", alpha = 0.6) +
  geom_hline(aes(yintercept = 3.5), color = "#ed1c2e", alpha = 0.6) +
  facet_wrap(vars(tekn_tknavn)) +
  theme_bw() +
  labs(x = "\nKjøretøylengde (m)", y = "Tillatt totalvekt (tonn)\n") +
  ggtitle("Sammenheng mellom lengde og tillatt totalvekt")
```

```{r bin}
small_vehicles_grouped %>% 
  ggplot(aes(kategori, antall)) +
  ggplot2::geom_col() +
  geom_text(aes(label = antall,
                   y = 1e5),
              color = "grey",
              position = position_dodge(0.9),
              vjust = 0) +
  facet_wrap(vars(tekn_tknavn)) +
  theme_bw() +
  labs(x = "\nKategori", y = "Antall\n") +
  ggtitle("Sammenheng mellom lengde og tillatt totalvekt")
```

