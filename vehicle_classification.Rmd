---
title: "Lengde- og kjøretøyklassifisering i Norge"
output: html_notebook
---


```{r setup, include = FALSE, echo = FALSE}
# Packages
library(tidyverse)
library(flextable)
library(hexbin)

# knitr options
knitr::opts_chunk$set(echo = FALSE,
                      warning = FALSE,
                      message = FALSE,
                      error = FALSE)

# Data is prepared in vehicle_register_data_prep.R
```


Kjøretøyregisteret er et åpent datasett. I denne analysen er det sett på kjøretøylengde og klassifisering. Kjøretøy kan klassifiseres etter ulike parametre. I Kjøretøyforskriften benyttes oftest tillatt totalvekt, der det vanligste skillet er 3,5 tonn (skillet mellom lett og tung).


# Sammenhengen mellom lengde og tillatt totalvekt

Spredningsplott for kun 200 000 av de 1,6 mill. kjøretøyene:

```{r getdata}
all_small_vehicles %>% 
  dplyr::slice(1:200000) %>% 
  ggplot(aes(tekn_lengde, tekn_totvekt)) +
  ggplot2::geom_point() +
  geom_vline(aes(xintercept = 5.6), color = "#ed1c2e", alpha = 0.6) +
  geom_hline(aes(yintercept = 3.5), color = "#ed1c2e", alpha = 0.6) +
  facet_wrap(vars(tekn_tknavn)) +
  theme_bw() +
  labs(x = "\nKjøretøylengde (m)", y = "Tillatt totalvekt (tonn)\n") +
  ggtitle("Sammenheng mellom lengde og tillatt totalvekt")
```


```{r vegtek}
# vegtek_columns_to_be_removed <- c("tekn_drivst",
#                                   "tekn_euronorm_ny",
#                                   "tekn_hybrid",
#                                   "tekn_hybrid_kategori",
#                                   "tekn_merkenavn")
# 
# vehicle_info %>% 
#         dplyr::select(!tidyselect::all_of(vegtek_columns_to_be_removed)) %>% 
#         writexl::write_xlsx(path = "kjoretoy_O3.xlsx")
```

Forsøk på tredimensjonalt spredningsplott. Lys farge indikerer større antall kjøretøy. Alle 1,6 mill. kjøretøyene.

```{r 2d}
all_small_vehicles %>% 
  #dplyr::slice(1:200000) %>% 
  ggplot(aes(tekn_lengde, tekn_totvekt)) +
  ggplot2::geom_hex() +
  geom_vline(aes(xintercept = 5.6), color = "#ed1c2e", alpha = 0.6) +
  geom_hline(aes(yintercept = 3.5), color = "#ed1c2e", alpha = 0.6) +
  facet_wrap(vars(tekn_tknavn)) +
  theme_bw() +
  labs(x = "\nKjøretøylengde (m)", y = "Tillatt totalvekt (tonn)\n") +
  ggtitle("Sammenheng mellom lengde og tillatt totalvekt")
```

Fordeling i kategorier hvor skillene er 5,6 m og 3,5 tonn.

```{r bin}
small_vehicles_grouped %>% 
  ggplot(aes(kategori, antall)) +
  ggplot2::geom_col() +
  geom_text(aes(label = antall,
                   y = 1e5),
              color = "grey",
              position = position_dodge(0.9),
              vjust = 0) +
  facet_wrap(vars(tekn_tknavn)) +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 90),
        panel.grid.minor.x = element_blank()) +
  labs(x = "\nKategori", y = "Antall\n") +
  ggtitle("Sammenheng mellom lengde og tillatt totalvekt")
```

