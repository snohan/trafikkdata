---
title: "Lengde- og kjøretøyklassifisering av vegtrafikk i Norge"
output: 
  officedown::rdocx_document:
    reference_docx: svv_template.docx
    toc: true
    toc_depth: 2
    fig_caption: true
    fig_width: 7
    tables:
      style: Table
      layout: autofit
      width: 1.0
      caption:
        style: Tabelltekst
        pre: 'Tabell'
        sep: '. '
      conditional:
        first_row: true
        first_column: false
        last_row: false
        last_column: false
        no_hband: false
        no_vband: true
    plots:
      style: Normal
      align: center
      caption:
        style: Figurtekst
        pre: 'Figur '
        sep: '. '
    lists:
      ol.style: null
      ul.style: null
---

```{r setup, include = FALSE, echo = FALSE}
source("H:/Programmering/R/byindeks/rmd_setup.R")

knitr::opts_chunk$set(fig.width = 6
                      )

# Data is prepared in vehicle_register_data_prep.R
```

```{r data}
vehicles_5.4_grouped <-
  read.csv2("kjoretoyregisteret/vehicles_5.4_grouped.csv")

vehicles_5.6_grouped <-
  read.csv2("kjoretoyregisteret/vehicles_5.6_grouped.csv")

vehicles_5.8_grouped <-
  read.csv2("kjoretoyregisteret/vehicles_5.8_grouped.csv")

vehicles_6.0_grouped <-
  read.csv2("kjoretoyregisteret/vehicles_6.0_grouped.csv")

vehicles_relative <-
  read.csv2("kjoretoyregisteret/vehicles_relative.csv")
```

<br>

**Tabelliste**
```{r list_of_tables}
officer::block_toc(style = "Tabelltekst")
```

<br>

**Figurliste**
```{r list_of_figures}
officer::block_toc(style = "Figurtekst")
```


# Sammendrag
DDD


# Bakgrunn
I trafikkdatasammenheng har det i mange år vært vanlig å klassifisere motorkjøretøy  basert på _målt_ lengde. Den målte lengden er typisk brukt til å dele inn kjøretøy i to klasser: lette og tunge. Målt lengde er derfor en tilnærming til skillet for tillatt totalvekt på 3,5 tonn som er grensen mellom lette og tunge kjøretøy, slik den er definert i Kjøretøyforskriften. Den tilsvarende grensen for målt lengde har alltid vært satt til 5,6 m.

Denne rapporten tar for seg sammenhengen mellom den tradisjonelle lengdeklassifiseringen og kjøretøyklassifiseringen slik den er beskrevet i Kjøretøyforskriften. Videre sammenlignes dette med en felles nordisk standard for kjøretøyklassifisering, samt klassifiseringen som fås fra trafikkregistreringsutstyret som benyttes til innsamling av trafikkdata i Norge.

Sammenhenger mellom lengde- og kjøretøyklassifisering er basert på tekniske data fra  Kjøretøyregisteret.


# Lengdeklassifisering
Den tradisjonelle lengdeklassifiseringen baserer seg på målt lengde, og har to nivåer.

Nivå 1 har to klasser:

  - under 5,6 m: lette kjøretøy, dvs. under 3,5 tonn
  - over 5,6 m: tunge kjøretøy, dvs. fra og med 3,5 tonn
  
Nivå 2 har seks klasser:

  - under 5,6 m: lette kjøretøy, dvs. under 3,5 tonn
  - fra 5,6 m til 7,6 m
  - fra 7,6 m til 12,5 m
  - fra 12,5 m til 16 m
  - fra 16 m til 24 m
  - fra 24 m

Tidligere var motorsykler angitt som egen klasse. Disse er nå inkludert i klassen under 5,6 m.


# Kjøretøyforskriftens kjøretøygrupper
Kjøretøyforskriftens kapittel 2 lister opp kjøretøygrupper som inndelt etter tillatt totalvekt og/eller antall sitteplasser. I det følgende er vekt oppgitt i tonn, og det er alltid tillatt totalvekt det er snakk om.

Følgende kjøretøygrupper nevnes i forskriften:

  - M1 (personbil, maks 9 personer)
  - M2 (buss, flere enn 8 sitteplasser, maks 5 tonn)
  - M3 (buss, flere enn 8 sitteplasser, over 5 tonn)
  - N1 (varebil, maks 3,5 tonn)
  - N2 (lastebil, mellom 3,5 og 12 tonn)
  - N3 (lastebil, over 12 tonn)
  - O1 (tilhenger, maks 0,75 tonn)
  - O2 (tilhenger, mellom 0,75 og 3,5 tonn)
  - O3 (tilhenger, mellom 3,5 og 10 tonn)
  - O4 (tilhenger, over 10 tonn)
  - G (terrenggående varianter av gruppende M og N. For eksempel er en ganske vanlig personbil som Toyota Land Cruiser blant disse)
  - L (moped og motorsykkel, med undergrupper som ikke er relevante her)
  - T (traktor, med undergrupper som ikke er relevante her)
  - C (beltetraktor, med undergrupper som ikke er relevante her)
  - R (traktorhenger, med undergrupper som ikke er relevante her)
  - S (utskiftbar trukket maskin, med undergrupper som ikke er relevante her)
  

# Nordisk klassifiseringsstandard (NorSIKT)
De nordiske landene har samarbeidet om et felles klassifiseringssystem, Nordic System for Intelligent Classification of Traffic (NorSIKT). Systemet inneholder 6 nivåer med ulikt antall klasser. Nivå 1 er triviell og har kun én klasse for motorkjøretøy.

NorSIKT nivå 2 har følgende tre klasser:

  - LMV: light motor vehicle (lett kjøretøy)
  - HMV: heavy motor vehicle (tungt kjøretøy)
  - OMV: other motor vehicle (andre kjøretøy)
  
NorSIKT nivå 3 har følgende fire klasser:

  - MC_MP: motorcycle, moped (motorsykkel, moped)
  - PC_LGV_LB: personal car, light goods vehicle, light bus (personbil, varebil, lett buss)
  - HMV: heavy motor vehicle (tungt kjøretøy)
  - OMV: other motor vehicle (andre kjøretøy)
  
NorSIKT nivå 4 har følgende seks klasser:

  - MC_MP: motorcycle, moped (motorsykkel, moped)
  - PC_LGV: personal car, light goods vehicle (personbil, varebil)
  - LB: light bus (lett buss)
  - HB: heavy bus (tung buss)
  - HGV_RT_EMS: heavy goods vehicle, road tractor, other heavy vehicle (lastebil, trekkbil, annet tungt kjøretøy)
  - OMV: other motor vehicle (andre kjøretøy)


NorSIKT nivå 5 har følgende åtte klasser:

  - MC_MP: motorcycle, moped (motorsykkel, moped)
  - PC_LGV: personal car, light goods vehicle (personbil, varebil)
  - LB: light bus (lett buss)
  - HB: heavy bus (tung buss)
  - HGV: heavy goods vehicle (lastebil)
  - RT: road tractor (trekkbil)
  - EMS: other heavy vehicle (annet tungt kjøretøy)
  - OMV: other motor vehicle (andre kjøretøy)
  
  
NorSIKT nivå 6 har følgende 13 klasser:

  - MP: moped (moped)
  - MC: motorcycle (motorsykkel)
  - PC: personal car (personbil)
  - Small LGV: small light goods vehicle (liten varebil)
  - Big LGV: big light goods vehicle (stor varebil)
  - LB: light bus (lett buss)
  - HB: heavy bus (tung buss)
  - HGV: heavy goods vehicle (lastebil)
  - HGV_WC: heavy goods vehicle with coupled vehicle (lastebil med henger)
  - RT: road tractor (trekkbil)
  - RT_WC: road tractor with coupled vehicle (trekkbil med semitrailer)
  - EMS: other heavy vehicle (annet tungt kjøretøy)
  - OMV: other motor vehicle (andre kjøretøy)
  

# Kjøretøyklasser fra trafikkregistreringsutstyr
Kjøretøyklassifiseringen som trafikkregistreringsutstyret gir er basert på mer enn bare lengdemåling. Hvilke måleverdier som inngår i klassifiseringen er avhengig av sensortype og leverandør.

I perioden fra 2015 til 2018 ble det innfaset nytt utstyr som gir klassifisering. Det er til nå blitt registrert med to ulike apparattyper.

Fra Loop Monitor får vi følgende 11 kjøretøyklasser:

  - 1: motorsykkel
  - 2: personbil
  - 3: personbil med henger
  - 4: varebil
  - 5: varebil med henger
  - 6: buss
  - 71: Liten lastebil
  - 72: Lastebil
  - 8: Vogntog
  - 9: semitrailer
  - 10 eller blank: uklassifisert

Fra EMU3 får vi følgende 6 kjøretøyklasser:

  - LMV1: motorsykkel, moped
  - LMV2: personbil, lett varebil
  - LMV2_WC: personbil, lett varebil med henger
  - HMV: lastebil
  - HMV_WC: lastebil med henger
  - UC/LOOP: uklassifisert
  

# Sammenheng mellom lengde og tillatt totalvekt
Teknisk kjøretøyinformasjon i Kjøretøyregisteret er et åpent datasett som her er grunnlag for en analyse av sammenhengen mellom kjøretøylengde og klassifisering. Spørsmålet er hvor godt lengdegrensen på 5,6 m passer med skillet mellom lett og tung på 3,5 tonn tillatt totalvekt.


## Datagrunnlag
Datagrunnlaget i denne analysen er teknisk informasjon om dagens bilpark. Derfor begrenses datagrunnlaget til kjøretøy som har status "registrert", og kjøretøy som er avskiltet eller vraket inngår ikke. Videre er det begrenset til kjøretøy som er registrert første gang etter 1.1.2000, da eldre kjøretøy antas å utgjøre en neglisjerbar andel av dagens kjørte kilometer på det norske vegnettet.

For å se nærmere på grensen mellom lette og tunge, er det tilstrekkelig å inkludere følgende kjøretøygrupper slik de er definert i Kjøretøyforskriften:

  - M1, M1G (personbil, maks 8 sitteplasser)
  - M2, M2G (minibuss, flere enn 8 sitteplasser, maks 5 tonn totalvekt)
  - N1, N1G (lett varebil, maks 3,5 tonn totalvekt)
  - N2, N2G (lett lastebil, totalvekt mellom 3,5 og 12 tonn)

De øvrige klassene inneholder kun lengre kjøretøy.


## Analyse
Ved å kategorisere alle kjøretøy etter kombinasjon av lengde og tillatt totalvekt, kan de deles inn i disse fire kategoriene:

  - Korte og lette: under 5,6 m og opp til og med 3,5 tonn.
  - Korte og tunge: under 5,6 m og over 3,5 tonn.
  - Lange og lette: 5,6 m eller mer og opp til og med 3,5 tonn.
  - Lange og tunge: 5,6 m eller mer og over 3,5 tonn.
  
Den første og siste kategorien er i harmoni med tanken om å skille lette og tunge kjøretøy ved 5,6 m. De to midterste kategoriene er i denne sammenhengen selvmotsigende, og bør helst inneholde så få kjøretøy som mulig.

I de følgende figurene er det vist hvordan kjøretøyene fordeler seg i disse fire kategoriene for ulike valg av lengdegrensen.


```{r vegtek}
# vegtek_columns_to_be_removed <- c("tekn_drivst",
#                                   "tekn_euronorm_ny",
#                                   "tekn_hybrid",
#                                   "tekn_hybrid_kategori",
#                                   "tekn_merkenavn")
# 
# vehicle_info %>% 
#         dplyr::select(!tidyselect::all_of(vegtek_columns_to_be_removed)) %>% 
#         writexl::write_xlsx(path = "kjoretoy_O3.xlsx")
```

```{r combination_plot_function}
plot_combination_distribution <- function(vehicle_grouped_df, subtitle_text) {
  
  vehicle_grouped_df %>% 
    ggplot(aes(kategori, antall)) +
    ggplot2::geom_col() +
    geom_text(aes(label = antall,
                     y = 1e5),
                color = "grey",
                position = position_dodge(0.9),
                vjust = 0) +
    facet_wrap(vars(tekn_tknavn)) +
    theme_bw() +
    theme(axis.text.x = element_text(angle = 90),
          axis.title.y = element_text(
            margin = margin(t = 0, r = 15, b = 0, l = 0)),
          axis.title.x = element_text(
            margin = margin(t = 15, r = 0, b = 0, l = 0)),
          panel.grid.minor.x = element_blank()) +
    labs(x = "Kategori", y = "Antall kjøretøy") +
    ggtitle("Sammenheng mellom lengde og tillatt totalvekt",
            subtitle = subtitle_text)
    
}
```


```{r bin_5_4, fig.cap="Fordeling av antall kjøretøy i kombinasjon av vekt og lengde når lengdeskillet er satt til 5,4 m."}
plot_combination_distribution(vehicles_5.4_grouped,
                              "Lengdeskille på 5,4 m")
```
<br>

```{r bin_5_6, fig.cap="Fordeling av antall kjøretøy i kombinasjon av vekt og lengde når lengdeskillet er satt til 5,6 m."}
plot_combination_distribution(vehicles_5.6_grouped,
                              "Lengdeskille på 5,6 m")
```
<br>

```{r bin_5_8, fig.cap="Fordeling av antall kjøretøy i kombinasjon av vekt og lengde når lengdeskillet er satt til 5,8 m."}
plot_combination_distribution(vehicles_5.8_grouped,
                              "Lengdeskille på 5,8 m")
```
<br>

```{r bin_6_0, fig.cap="Fordeling av antall kjøretøy i kombinasjon av vekt og lengde når lengdeskillet er satt til 6,0 m."}
plot_combination_distribution(vehicles_6.0_grouped,
                              "Lengdeskille på 6,0 m")
```
<br>

I alle disse tilfellene er det "kort og lett" som dominerer i antall. Det er relativt små forskjeller i fordelingen.

For enklere å kunne sammenligne fordelingen mellom de ulike lengdevalgene, settes disse i samme visualisering hvor vi ser på forskjellige lengdeskiller og relativ fordeling av kjøretøyene i kategorier.


```{r rel_dist}
vehicles_relative %>% 
  dplyr::filter(lengdegrense %in% c(
    "5.4", "5.6", "6", "6.5", "7", "7.3", "7.4", "7.5", "8", "8.5"
    )) %>% 
  ggplot(aes(kategori, prosentandel, fill = lengdegrense)) +
  ggplot2::geom_col(position = "dodge") +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 90),
        axis.title.y = element_text(
          margin = margin(t = 0, r = 15, b = 0, l = 0)),
        axis.title.x = element_text(
          margin = margin(t = 15, r = 0, b = 0, l = 0)),
        panel.grid.minor.x = element_blank()) +
  scale_fill_brewer(palette = "Set3") +
  labs(x = "Kategori", y = "Prosentandel (%)") +
  ggtitle("Sammenheng mellom lengde og tillatt totalvekt")
```
<br>

Ser nærmere på de to mellomkategoriene som vi vil ha færrest mulig kjøretøy i.

<br>

```{r rel_dist_closer}
vehicles_relative %>%
  dplyr::filter(kategori %in% c("kort_og_tung", "lang_og_lett")) %>% 
  ggplot(aes(lengdegrense, prosentandel, fill = kategori)) +
  ggplot2::geom_col(position = "stack") +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 90),
        axis.title.y = element_text(
          margin = margin(t = 0, r = 15, b = 0, l = 0)),
        axis.title.x = element_text(
          margin = margin(t = 15, r = 0, b = 0, l = 0)),
        panel.grid.minor.x = element_blank(),
        legend.position = "bottom") +
  scale_fill_brewer(palette = "Dark2") +
  labs(x = "Lengdegrense", y = "Prosentandel (%)") +
  ggtitle("Sammenheng mellom lengde og tillatt totalvekt",
          subtitle = "Andel kjøretøy i blandet kategori")
```
<br>

Konklusjonen er at 7,5 m er det optimale, men at forskjellen ikke er mer enn omkring 1,5 prosentpoeng fra 5,6 m. Ved 5,6 m er ca. 2,2 % av kjøretøyene i Kjøretøyregisteret i en av blandingskategoriene. Med 7,5 m er andelen 0,7 %. Det er et markant dropp ved 6 m, og dette harmonerer med det både EMU3 og LM benytter som et av kriteriene for sin klassifisering.


## Korte og tunge
Med 5,6 m som grense er det kun 500 kjøretøy som samtidig er korte og tunge. Typisk er dette SUV-er, små varebiler eller veldig små lastebiler. Med 6,0 m som grense økes denn gruppa til 2 200 kjøretøy, men den består av de samme typene.


## Lange og lette
Mange kjøretøy er definert med tillatt totalvekt på nøyaktig 3,5 tonn (tilpasset krav til førerkort, avgift m.m.). Disse er det 35 000 av når lengdegrensen er 5,6 m. Typisk er disse varebiler og bobiler.


## Overrepresentasjon av bobiler
Det er velkjent at bobiler i perioder utgjør en større andel av kjøretøyene på vegen enn de utgjør i selve kjøretøyregisteret. Dette vil gjerne være tilfelle på (Nasjonale) turistveger i juni. En stor andel av disse er definert som lette (tillatt totalvekt på akkurat 3,5 tonn), men er betydelig lenger enn 5,6 m, typisk 6,0-7,5 m. Disse vil bli lengdeklassifisert over 5,6 m og føre til en for høy andel tunge.


## Overrepresentasjon av varebiler
I byområder er det høy andel varebiler. En andel av disse er definert som lette (tillatt totalvekt på akkurat 3,5 tonn), men er betydelig lenger enn 5,6 m, typisk 6,0-7,5 m. Disse vil bli lengdeklassifisert over 5,6 m og føre til en for høy andel tunge.


## Lette og korte biler med henger
Kombinasjonen av lette og korte biler med hvilken som helst henger, vil gi samlet lengde over 5,6 m. Disse vil bli lengdeklassifisert over 5,6 m og føre til en for høy andel tunge. Overrepresentasjon av dette vil typisk være sommertrafikk med campingvogn og lastehenger ved hytteområder.


# Feilkilder
Fordelingene presentert over er teoretiske og tar ikke hensyn til at ulike kjøretøy benyttes ulikt. Det kan være at lengre kjøretøy kjører mer enn korte, og at "problemområdet" rundt 5,6 m utgjør en større andel av trafikkarbeidet enn i Kjøretøyregisteret.

Lengdemålinger har alltid noe usikkerhet knyttet til seg. I hvilken grad påvirker dette fordelingen av lette og tunge? Se egen rapport.


# Sammenheng mellom klassifiseringssystemene
DDD

NorSiKT nivå 2:

- LMV
- HMV
- OMV (ukjent)

NorSiKT nivå 3 (kjøretøyforskriftens klasser i parentes):

- MC (L)
- LMV (M1, N1)
- HMV (M2, M3, N2, N3, T)
- OMV

Hybridnivå mellom NorSiKT 6 og LM (LMs klasser i parentes):

- MC (1)
- LMV (2, 4)
- LMV+WC (3, 5)
- HB (6)
- HGV+WOC (71, 72)
- HGV+WC (8)
- RT+WOC
- RT+WC (9)
- OMV

OBS! Skal vi ha egne klasser med henger?









